require 'test_helper'

class JOSE::JWA::Curve25519_RbNaClTest < Minitest::Test

  EdDSA_SECRET        = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].pack('C*')
  EdDSA_SK            = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,59,106,39,188,206,182,164,45,98,163,168,208,42,111,13,115,101,50,21,119,29,226,67,166,58,192,72,161,139,89,218,41].pack('C*')
  EdDSA_PK            = [59,106,39,188,206,182,164,45,98,163,168,208,42,111,13,115,101,50,21,119,29,226,67,166,58,192,72,161,139,89,218,41].pack('C*')
  EdDSA_M             = [143,137,91,60,175,226,201,80,96,57,208,226,166,99,130,86,128,4,103,79,232,210,55,120,80,146,228,13,106,175,72,62,79,198,1,104,112,95,49,241,1,89,97,56,206,33,170,53,124,13,50,160,100,244,35,220,62,228,170,58,191,83,248,3].pack('C*')
  Ed25519_SIGNATURE   = [41,13,154,178,137,160,128,144,140,163,130,167,13,188,171,152,138,171,163,229,123,125,178,222,201,119,31,0,244,114,40,135,185,194,25,223,208,40,26,246,220,92,60,130,121,177,46,218,177,207,103,148,115,236,154,41,233,169,27,182,157,125,23,11].pack('C*')
  Ed25519ph_SIGNATURE = [99,146,10,64,251,96,187,115,154,193,232,23,243,125,159,138,198,173,49,91,250,230,124,186,106,14,225,15,195,111,55,210,137,77,19,250,148,204,114,68,57,177,38,94,69,116,89,197,65,35,186,106,61,54,120,211,45,27,53,190,175,167,49,11].pack('C*')
  Curve25519_SECRET   = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64].pack('C*')
  Curve25519_PUBLIC   = [47,229,125,163,71,205,98,67,21,40,218,172,95,187,41,7,48,255,246,132,175,196,207,194,237,144,153,95,88,203,59,116].pack('C*')
  Curve25519_SHARED   = [147,254,162,167,193,174,182,44,253,100,82,255,91,173,174,139,223,252,189,113,150,220,145,12,137,148,64,6,216,93,187,104].pack('C*')

  def test_supported_methods
    if JOSE::JWA::Curve25519_RbNaCl.__supported__?
      [
        [[EdDSA_PK, EdDSA_SK], :ed25519_keypair, EdDSA_SECRET],
        [EdDSA_PK, :ed25519_secret_to_public, EdDSA_SK],
        [Ed25519_SIGNATURE, :ed25519_sign, EdDSA_M, EdDSA_SK],
        [true, :ed25519_verify, Ed25519_SIGNATURE, EdDSA_M, EdDSA_PK],
        [[EdDSA_PK, EdDSA_SK], :ed25519ph_keypair, EdDSA_SECRET],
        [EdDSA_PK, :ed25519ph_secret_to_public, EdDSA_SK],
        [Ed25519ph_SIGNATURE, :ed25519ph_sign, EdDSA_M, EdDSA_SK],
        [true, :ed25519ph_verify, Ed25519ph_SIGNATURE, EdDSA_M, EdDSA_PK],
        [[Curve25519_PUBLIC, Curve25519_SECRET], :x25519_keypair, Curve25519_SECRET],
        [Curve25519_PUBLIC, :x25519_secret_to_public, Curve25519_SECRET],
        [Curve25519_SHARED, :x25519_shared_secret, Curve25519_PUBLIC, Curve25519_SECRET]
      ].each do |(expected, function, *args)|
        assert_equal expected, JOSE::JWA::Curve25519_RbNaCl.send(function, *args)
      end
    end
  end

end
